# 守护进程

[原文地址](https://mp.weixin.qq.com/s/H9To_z1kiRpo6GHP0NypIA)

## 概念

守护进程，也就是通常所说的Daemon进程，是Linux中的后台服务进程。周期性的执行某种任务或等待处理某些发生的事件。

Linux系统有很多守护进程，大多数服务都是用守护进程实现的。比如：像我们的tftp，samba，nfs等相关服务。

UNIX的守护进程一般都命名为*d的形式，如httpd，telnetd等等。

## 生命周期

守护进程会长时间运行，常常在系统启动时就开始运行，直到系统关闭时才终止。

## 守护进程不依赖于终端

从终端开始运行的进程都会依附于这个终端，这个终端称为这些进程的控制终端。当控制终端被关闭时，相应的进程都会被自动关闭。咱们平常写进程时，一个死循环程序，咱们不知道有ctrl+c的时候，怎么关闭它呀，是不是关闭终端呀。也就是说关闭终端的同时也关闭了我们的程序，但是对于守护进程来说，其生命周期守护需要突破这种限制，它从开始运行，直到整个系统关闭才会退出，所以守护进程不能依赖于终端。

## 查看守护进程

```shell
ps axj

# a: 显示所有 

# x：显示没有控制终端的进程 

# j：显示与作业有关的信息（显示的列）：会话期ID（SID），进程组ID（PGID），控制终端（TT），终端进程组ID（TRGID）
```

![image-20220328134108253](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20220328134108253.png)

- 所有的守护进程都是以超级用户启动的(UID为0)；

- 没有控制终端(TTY为？)；

- 终端进程组ID为-1(TPGID表示终端进程组ID，该值表示与控制终端相关的前台进程组，如果未和任何终端相关，其值为-1；

- 所有的守护进程的父进程：

```
历史上，Linux 的启动一直采用init进程；下面的命令用来启动服务。

这种方法有两个缺点：
1. 启动时间长。init进程是串行启动，只有前一个进程启动完，才会启动下一个进程。
2. 启动脚本复杂。init进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，
这往往使得脚本变得很长。
```

**Systemd** 

就是为了解决这些问题而诞生的。它的设计目标是，为系统的启动和管理提供一套完整的解决方案。

根据 Linux 惯例，字母d是守护进程（daemon）的缩写。Systemd 这个名字的含义，就是它要守护整个系统。