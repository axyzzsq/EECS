# Flush

## What is it?

在计算机领域，术语 "刷新 "通常用于指将当前存储在缓冲区的数据写入目标存储设备的行为。缓冲区是一个临时的内存区域，用于在数据被写入文件、通过网络发送或显示在屏幕上之前保存数据。

当数据被写入缓冲区时，它不会立即被写入目标存储设备，而是被保留在缓冲区中，直到满足某些条件，如缓冲区已满或程序要求写入数据时。冲洗缓冲器意味着当前存储在缓冲器中的数据被强制写入目标存储设备，而不管缓冲器是否已满。

例如，当向文件写入数据时，程序可能会使用缓冲区来暂时存储数据，然后再写入文件。如果程序不明确地冲刷缓冲区，即使在程序执行完毕后，数据仍可能留在缓冲区内，有可能导致数据丢失。冲洗缓冲区可以确保在程序终止前将数据写到文件中。

综上所述，冲刷是将数据从缓冲区强行写入目标存储设备的行为，通常是为了确保数据被正确保存或传输。

## How to use?

```C
#include <stdio.h>

int main() {
   FILE *fp;
   char str[] = "This is a test.\n";
 
   // Open file for writing
   fp = fopen("test.txt", "w");
   
   // Write string to buffer
   fputs(str, fp);
   
   // Flush buffer to disk
   fflush(fp);
   
   // Close file
   fclose(fp);
   
   return 0;
}

```

在这个例子中，我们首先使用`fopen()`函数打开一个名为 "test.txt "的文件进行写作。然后我们使用`fputs()`函数将字符串 "这是一个测试。"写到缓冲区。在我们使用`fclose()`关闭文件之前，我们调用`fflush()`函数以确保任何仍然存储在缓冲区的数据被写入磁盘。

`fflush()`函数以一个文件指针为参数，将仍在与该文件相关的缓冲区中的任何数据写入磁盘。当你想确保数据被立即写入磁盘，而不是等待缓冲区被填满或文件被关闭时，这一点特别有用。

![image-20230224120049994](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20230224120049994.png)

## Why use it?

There are several possible disadvantages of not using flush:

1. 数据丢失：如果在关闭文件或终止程序之前不刷新缓冲区，则缓冲区中的任何数据都可能丢失。 发生这种情况是因为数据尚未写入目标存储设备，仍仅存储在内存中。

2. 性能问题：当你向文件写入数据时，操作系统通常会使用一个缓冲区来临时存储数据。 如果不刷新缓冲区，数据可能会在内存中保留很长时间，这会消耗系统资源并降低性能。

3. 文件损坏：如果程序崩溃或意外终止，而数据仍在缓冲区中，文件可能会损坏。 这是因为数据还没有完全写入文件，可能不完整或不一致。

4. 结果不准确：如果程序根据缓冲区中的数据进行一些计算，而缓冲区还没有被刷新，则结果可能不准确。 发生这种情况是因为计算中使用的数据可能未反映最新值。

总之，不使用刷新可能导致数据丢失、性能问题、文件损坏和不准确的结果。重要的是要确保在关闭文件或终止程序之前冲刷缓冲区，以防止这些问题。