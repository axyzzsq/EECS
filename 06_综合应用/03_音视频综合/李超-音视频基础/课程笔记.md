# 音视频基础与FFmpeg原理

## 第一章 课程概要

![image-20221127152302513](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127152302513.png)

课程技能：

- 音视频基础知识
- H264编码原理与参数调优
- 实战音视频采集
- 实战音视频编码
- 构建大并发流媒体服务器
- RTMP传输

## 第二章 音视频环境基础

### 2-1 音视频应用的场景

- 直播系统，常用工具

  - ffmpeg
  - ffplay
  - vlc

- 架构模型

  ![image-20221127154506165](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127154506165.png)

### 2-2 推流中断与画质不清晰的解决办法

- 推流中断:

  ![image-20221127155000766](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127155000766.png)

  - 原因：推流时，时间戳错误，音视频被隔离，导致音视频不同步；

  - 解决方法：加入re参数

    ![image-20221127155102634](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127155102634.png)

- 画质不清晰：![image-20221127155146310](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127155146310.png)

  - 原因：-f flv导致ffmpeg对mp4文件进行重新编码再播放，重新编码导致了视频质量降低
  - 解决方案：加入 -c copy参数，表示不让多媒体对流媒体文件重新编码，而是直接进行复制再播放

### 2-3 环境变量设置

- PATH
- PKG_CONFIG_PATH(pkg-config)
- LD_LIBRARAY_PATH

## 第三章 Linux编译ffmpeg

- step1: FFmpeg官网download源码 `https://ffmpeg.org/download.html`

- 进入源码一级目录，设置安装路径

  ```
  ./configure --prefix=/usr/local/ffmpeg --enable-debug=3
  ```

- 编译

  ```shell
  make -j8
  ```

- 安装

  ```shell
  make install
  ```

> tips
>
> 编译帮助命令
>
> ```shell
> ./configure --help
> ```

- 编译出ffplay的解决方法

  - ```shell
    ./configure --prefix=/usr/local/ffmpeg --enable-debug=3 --enable-shared --disable-static --enable-sdl
    ```

 ## 第四章 C语言基础

略

 ## 第五章 音频基础知识

### 5-1 音视频处理流程

![image-20221127201648997](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127201648997.png)



音频数据流

![image-20221127202118318](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127202118318.png)



### 5-2 声音是如何被听到的

![image-20221127203032728](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127203032728.png)

![image-20221127203141016](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127203141016.png)



### 5-3 声音的三要素

![image-20221127203607660](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127203607660.png)

![image-20221127203617951](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127203617951.png)

![image-20221127203707254](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127203707254.png)

![image-20221127203828008](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127203828008.png)

基波+谐波



### 5-4 模数转换

![image-20221127204107269](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127204107269.png)

![image-20221127204119031](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127204119031.png)

![image-20221127204143247](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127204143247.png)

![image-20221127204238426](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127204238426.png)

![image-20221127204323233](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127204323233.png)

### 5-5 音频原始数据 PCM与WAV

WAV就是封装了PCM之后加了一个头用于多媒体程序来识别这段数据。

![image-20221127204919057](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127204919057.png)

![image-20221127205128180](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127205128180.png)

![image-20221127205136977](C:\Users\Zhao S\AppData\Roaming\Typora\typora-user-images\image-20221127205136977.png)



![image-20221127205424020](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20221127205424020.png)

## 第六章 音频采集

### 6-1 通过命令的方式采集音频数据

```shell
ffmpeg -f avfoundation -i :0 out.wav  # 冒号前是视频，冒号后是音频  错的，要改
ffplay out.wav
```



### 6-2 swift语法



### 6-3 创建App



### 6-4 创建Button



### 6-5 swift调用C语言



### 6-6 App中引入ffmpeg库



### 6-7 打开音频设备



### 6-8 从音频设备中读取音频数据



### 6-9 代码优化



### 6-10 录制音频数据



### 6-11 通过界面来控制开启或者关闭录制



## 第七章 音频编码原理



## 第八章 音频编码



## 第九章 视频基础知识



## 第十章 H264编码原理



## 第十一章 视频编码/解码



## 第十二章 RTMP传输



## 第十三章 CDN实现商业娱乐直播

