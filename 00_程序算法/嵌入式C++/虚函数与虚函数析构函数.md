# 虚函数与虚函数析构函数

## 1、虚函数

微软解释: 虚函数是指一个类中你希望重载的成员函数，当你用一个基类指针或引用指向一个继承类对象的时候，你调用一个虚函数，实际调用的是继承类的版本。



## 2、虚函数析构函数

例程：

```cpp
#include<iostream>
using namespace std;
// 基类Base
class Base 
{
public:
    Base() 
    { 
        cout << "Base constructor" << endl; 
    }
    virtual ~Base() 
    { 
        cout << "Base destructor" << endl; 
    } // 虚析构函数
};

// 派生类Derived
class Derived : public Base 
{
public:
    Derived() 
    { 
        cout << "Derived constructor" << endl; 
    }
    ~Derived() 
    { 
        cout << "Derived destructor" << endl; 
    }
};

int main() 
{
    Base *p = new Derived(); // 基类指针指向派生类对象
    delete p; // 释放内存
    return 0;
}

/* 解析:
   这个代码演示了virtual析构函数的作用。如果没有virtual关键字，那么delete p只会调用基类的析构函数，而不会调用派生类的析构函      数，这样就会造成内存泄漏。但是由于基类的析构函数是虚拟的，所以delete p会根据虚拟表来动态调用派生类的析构函数，然后再调用基类    的析构函数，这样就可以正确地释放内存。
*/
```

执行结果：

![image-20230228205614229](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/image-20230228205614229.png)



## 3、如何理解基类指向派生类

[基类指针指向派生类对象是C++中实现多态的一种方式。多态指的是同一个接口的不同实现方式。基类指针可以指向派生类对象，因为派生类对象包含了基类对象的部分，也就是说，派生类是基类的一种特殊形式。](https://zhidao.baidu.com/question/347733542.html)[1](https://zhidao.baidu.com/question/347733542.html)[2](https://www.zhihu.com/question/25572937)

[当基类指针指向派生类对象时，如果调用的是普通函数，那么会根据指针类型来调用基类的函数；如果调用的是虚拟函数，那么会根据虚拟表来动态调用派生类的函数。](https://blog.csdn.net/hk121/article/details/81165391)[3](https://blog.csdn.net/hk121/article/details/81165391) 这样就可以实现不同类型的对象有不同的行为。

可以把基类和派生类想象成水果和苹果的关系。水果是一个大类，苹果是水果的一种，也就是说，苹果继承了水果的特征。如果你有一个水果指针，你可以让它指向一个苹果对象，因为苹果也是水果。但是如果你有一个苹果指针，你不能让它指向一个水果对象，因为水果不一定是苹果。

当你用水果指针指向苹果对象时，如果你调用的是普通函数，比如说吃函数，那么会根据指针类型来调用水果的吃函数；如果你调用的是虚拟函数，比如说颜色函数，那么会根据虚拟表来动态调用苹果的颜色函数。这样就可以实现不同类型的水果有不同的颜色。