# 基于状态机的按键检测

[博文链接](https://blog.csdn.net/qq_32108893/article/details/78979618?spm=1001.2101.3001.6650.3&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-3-78979618-blog-120126823.pc_relevant_multi_platform_whitelistv6&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-3-78979618-blog-120126823.pc_relevant_multi_platform_whitelistv6&utm_relevant_index=6)

一般在学单片机的时候，最基础的一个内容就是学习按键的输入扫描，最简单的方式当然是读IO电平然后再加上一段延时做消抖。今天要分享的是我自己写的一个基于状态机检测的按键扫描程序，使用状态机可以根据按键按下时长的不同状态实现短按单击、长按连击、长时间长按高速连击（我叫超级连击）的区分。

今天我所说的按键扫描程序全部是基于这种5向开关来做的，如果是矩阵按键扫描的话得做一些相应的修改。

![img](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/202209022358846.png)

原理图如下，一共6个引脚。一个公共端上拉，其他5个引脚接单片机IO口就可以了。

![img](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/202209022358521.png)

首先是最简单的按键输入方式，哪个按键按下就返回哪个按键的值，没有按下的时候就返回空格键，这里是纯粹的按键扫描，一般还要加入一个20ms到150ms之间的延迟函数来做按键消抖：

```C
uint8_t GetKeyInpt()
{
    uint8_t Key_x;
    if(Key_Up)
        Key_x = 'U';
    else if(Key_Down)
        Key_x = 'D';
    else if(Key_Left) 
        Key_x = 'L';
    else if(Key_Rignt)
        Key_x = 'R';
    else if(Key_Center)
        Key_x = 'C';
    else 
        Key_x = ' ';
    1return Key_x;
}
```

