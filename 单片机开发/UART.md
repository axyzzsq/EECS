# UART

## 1、uart的三种标准

> RS232是全双工的,RS485是半双工的,RS422是全双工的。

### 1.1 RS-232

 ![](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/20220326194536.png)

> - 历史：
>
> IBM的PC机将RS232简化成了DB-9连接器，而工业控制的RS-232口一般只使用RXD、TXD、GND三条线。
>
> - 特点：
>   - 信号线少
>     - RS-232总线规定了25条线，包含了两个信号通道，即第一通道（称为主通道）和第二通道（称为副通道）。利用RS- 232总线可以实现全双工通信，通常使用的是主通道，而副通道使用较少。在一般应用中，使用3条～9条信号线就可以实现全双工通信，采用三条信号线（接收线、发送线和信号地）能实现简单的全双工通信过程。
>   - 波特率
>     - RS-232规定的标准传送速率有50b/s、75b/s、110b/s、150b/s、300b/s、600b/s、1200b/s、2400b/s、4800b/s、9600b/s、19200b/s，根据外设的性能选择不同的速率。
>   - 采用负逻辑传送
>     - 规定逻辑“1”的电平为-5V~-15 V，逻辑“0”的电平为+5 V～+15 V。选用该电气标准的目的在于提高抗干扰能力，增大通信距离。RS -232的噪声容限为2V，接收器将能识别高至+3V的信号作为逻辑“0”，将低到-3 V的信号作为逻辑“1”。
>     - 为啥这种逻辑可以调高信号传输的抗扰能力？
>   - RS-232采取不平衡传输方式，即所谓单端通讯。收、发端的数据信号是相对于信号地。典型的RS-232信号在正负电平之间摆动。RS-232是为点对点通讯而设计的，其驱动器负载为3kΩ~7kΩ。所以RS-232适合本地设备之间的通信，最大传输波特率为256000，最大传输距离约15米，传输速度随传输距离增大而减小。

### 1.2 RS-485和RS-422

 ![](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/20220326194553.png)
>
>   RS-422标准全称是“平衡电压数字接口电路的电气特性”，它推出不久就发展了更高级的RS-485。它们相对于RS-232最大的优点有：首先是多机通讯，一主多从的通讯方式，允许一条总线上可以连接多达32个设备；其次大大延伸了通讯距离，通讯距离从十几米延伸至上千米。再次是通讯速率大大提高，最高传输速率为10Mbps。另外，由于其驱动电压也从25V降到6V，这样也就延长了接口电路的芯片的寿命：最后是连线方式也大大简化，从原来的9线，变为两线制(不含信号地。以前RS485也有四线制接法，该接法为全双工，但是只能实现点对点的通信方式，现很少采用)。由于PC机多数没有RS485接口，在实际中RS485很少独立使用，而是通过转换器将DB-9接口的RS-232转换成RS-485接口转换器，采用屏蔽双绞线传输。RS-485其典型的连线方式如下图
>
>   ![](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/20220326194608.png)
>
>   需要注意485总线必须要单点可靠接地。单点就是整个485总线上只能是有一个点接地，不能多点接地，因为将其接地是因为要将地线(一般都是屏蔽线作地线)上的电压保持一致，防止共模干扰，如果多点接地适得其反。另外在在低速、短距离、无干扰的场合可以不要匹配电阻，相反必须有120欧的匹配电阻。由于在一条总线上有多个设备，为了防止多个设备同时发出信息而相互干扰(撞包)，一主多从时，只能半双工通讯，如果从机要上报信息，只能等待主机轮询到该从机时，才可以发送信息，而主机发出的信息包所有从机都可接收到信息，所以主机发出的信息包中要有从机地址码，以便从机辨识发送给自己的信息包。

## 2、流控CTS RTS RX TX通信端口

![](https://pic-1304959529.cos.ap-guangzhou.myqcloud.com/DB/20220326194622.png)

> ### 引脚介绍
>
> - RTS:（Request To Send 请求发送）
>
>   - 模组的RTS是给mcu说准备好了,低电平，如果模组没有准备好，MCU给模组发数据，可能会丢包
>
> -  CTS:（Clear To Send 清除发送，允许发送）
>
>   - 模组的cts必须要外部的mcu给低电平，模组才能发送数据
>
> -  RXD: （Receive Data 接收数据）
>
>   - 接收数据
>
> - TXD:（ Transmit Data 发送数据）
>
>   - 发送数据
>
> ### 编程思路
>
> 1. 模块与MCU之间的串口是用硬件流控CTS、RTS两个IO口进行发送接收的通知和控制。
> 2. 这两个IO常态高位，置低触发。
> 3. 当模块可以接收数据时，模块会置低本机RTS（MCU为CTS）信号通知MCU可以发送数据。
> 4. 当MCU可以接收数据时，MCU要置低其RTS（模块为CTS）信号通知模块可以发送数据
>
> - 以信驰达科技的ND04(C）NRF52832/10模组为例：
>
> ```C
> void main(void){
>  	//等待BLE模块启动成功，信驰达模组ND04X,从机上电串口打印DEVICE_START
>  	while(!memcmp(rx_ble_mode_data(),"DEVICE_START\r\n",strlen("DEVICE_START\r\n")));
>  	//使能RTS，即MCU可接收BLE模块发送的数据
>     set_rts_enable();
> while(1){
> 	//获取CTS状态是否改变为低电平
> 	if(get_cts_state()==0){
> 	//发送测试数据到BLE模块
> 		mcu_send_to_ble_string("Testdata.\r\n");
> 	}
> 	//处理MCU获取到的数据
> 	mcu_data_process(mcu_uart_read_data());
> }
> }
> ```

